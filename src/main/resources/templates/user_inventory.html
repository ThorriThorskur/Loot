<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User Inventory</title>
</head>
<body>
<h1 th:text="'Inventory of ' + ${user.username}"></h1>
<p><a th:href="@{'/search?userId=' + ${user.id}}">Search for Cards</a></p>
<p><a th:href="@{/}">Back to Home</a></p>
<!-- Button to go to user's deck -->
<div th:if="${user.decks.size()} == 0">
    <p>You have no decks.</p>
    <form th:action="@{/createDeck}" method="post">
        <input type="hidden" name="userId" th:value="${user.id}" />
        <button type="submit">Create New Deck</button>
    </form>
</div>

<div th:if="${user.decks.size()} > 0">
    <h3>Your Decks:</h3>
    <ul>
        <li th:each="deck : ${user.decks}">
            <a th:href="@{'/user/' + ${user.id} + '/deck/' + ${deck.id}}"
               th:text="${deck.name}">View Deck</a>
        </li>
    </ul>
</div>

<div>
    <p>Sort By:
        <a th:href="@{'/user/inventory/sorted(sortBy='manaCost')}">Mana Cost</a> |
        <a th:href="@{'/user/inventory/sorted(sortBy='name')}">Name</a>
    </p>
</div>
<div th:if="${user.inventory.inventoryCards.size()} == 0">
    <p>Your inventory is empty.</p>
</div>
<div th:if="${user.inventory.inventoryCards.size()} > 0">
    <ul>
        <li th:each="inventoryCard : ${user.inventory.inventoryCards}">
            <h2 th:text="${inventoryCard.card.name}"></h2>
            <p><strong>Mana Cost:</strong> <span th:text="${inventoryCard.card.manaCost}">N/A</span></p>
            <p><strong>Type:</strong> <span th:text="${inventoryCard.card.typeLine}">N/A</span></p>
            <p><strong>Oracle Text:</strong> <span th:text="${inventoryCard.card.oracleText}">N/A</span></p>
            <p><strong>Price:</strong>
                <span th:text="${inventoryCard.card.usd != null ? '$' + inventoryCard.card.usd : 'N/A'}">N/A</span>
            </p>
            <p><strong>Foil Price:</strong>
                <span th:text="${inventoryCard.card.usdFoil != null ? '$' + inventoryCard.card.usdFoil : 'N/A'}">N/A</span>
            </p>
            <p><strong>Quantity:</strong> <span th:text="${inventoryCard.count}"></span></p>
            <!-- Display the card image -->
            <div th:if="${inventoryCard.card.imageUrl != null}">
                <img th:src="${inventoryCard.card.imageUrl}" alt="Card Image" />
            </div>
            <div th:unless="${inventoryCard.card.imageUrl != null}">
                <p>No image available.</p>
            </div>
            <!-- Optionally, add a remove button -->
            <form th:action="@{/removeCardFromInventory}" method="post">
                <input type="hidden" name="cardId" th:value="${inventoryCard.card.id}" />
                <input type="hidden" name="userId" th:value="${user.id}" />
                <button type="submit">Remove from Inventory</button>
            </form>
            <!-- Add a button to add the card to the deck -->
            <form th:action="@{/addCardToDeck}" method="post">
                <input type="hidden" name="cardId" th:value="${inventoryCard.card.id}" />
                <input type="hidden" name="userId" th:value="${user.id}" />
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit">Add to Deck</button>
            </form>

            <hr/>
        </li>
    </ul>
</div>
</body>
</html>
